(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{359:function(e,l,t){e.exports=t.p+"assets/img/reaster.a8d954cd.png"},373:function(e,l,t){"use strict";t.r(l);var i=t(25),s=Object(i.a)({},(function(){var e=this,l=e.$createElement,i=e._self._c||l;return i("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[i("h2",{attrs:{id:"浏览器渲染流程"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#浏览器渲染流程"}},[e._v("#")]),e._v(" 浏览器渲染流程")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("构建DOM 树 :")])]),e._v(" "),i("li",[i("ul",[i("li",[e._v("将html 转化为浏览器能识别的document tree")])])]),e._v(" "),i("li",[i("p",[e._v("计算样式")])]),e._v(" "),i("li",[i("ul",[i("li",[e._v("浏览器无法直接识别css,将css转化为styleSheets,其中涉及到:css的继承和层叠")])])]),e._v(" "),i("li",[i("p",[e._v("布局")])]),e._v(" "),i("li",[i("ul",[i("li",[i("p",[e._v("根据构建出来的DOM 和 计算出来的样式,浏览器会在布局阶段完成两个任务:生成布局树和布局计算")])]),e._v(" "),i("li",[i("ul",[i("li",[i("p",[e._v("生成布局树: 遍历DOM树所有可见的节点,将他们加到布局树,")])]),e._v(" "),i("li",[i("ul",[i("li",[i("p",[e._v("忽略不可见的节点")])]),e._v(" "),i("li",[i("ul",[i("li",[e._v("比如:head信息, display: none的元素都建被忽略")])])])])]),e._v(" "),i("li",[i("p",[e._v("计算布局: 计算布局阶段会将运算好的结果重新写会布局树"),i("span",{staticStyle:{display:"none"}},[e._v(".所以布局树即是输入内容 也是 输出内容,输入和输出内容没分开,不太合理,谷歌在重构(layoutNG)")])])]),e._v(" "),i("li",[i("ul",[i("li",[e._v("会计算出所有dom节点的样式 位置等")])])])])])])]),e._v(" "),i("li",[i("p",[e._v("分层(为了更好的实现一些复杂的效果(3D 装换, z-index,页面滚动等): 渲染引擎会"),i("strong",[e._v("根据布局树")]),e._v("为一些特定的节点生成分层树[layer tree])")])]),e._v(" "),i("li",[i("ul",[i("li",[i("p",[e._v("拥有"),i("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Understanding_z_index/The_stacking_context",target:"_blank",rel:"noopener noreferrer"}},[e._v("层叠上文"),i("OutboundLink")],1),e._v("属性的元素会被单独提升为一层")])]),e._v(" "),i("li",[i("ul",[i("li",[e._v("文档根元素（"),i("html",[e._v("）； - position 值为 absolute（绝对定位）或 relative（相对定位）且 z-index 值不为 auto 的元素； - position 值为 fixed（固定定位）或 sticky（粘滞定位）的元素（沾滞定位适配所有移动设备上的浏览器，但老的桌面浏览器不支持）； - flex (flexbox) 容器的子元素，且 z-index 值不为 auto； - grid (grid) 容器的子元素，且 z-index 值不为 auto； - opacity 属性值小于 1 的元素（参见 the specification for opacity）； - mix-blend-mode 属性值不为 normal 的元素； - 以下任意属性值不为 none 的元素： - transform - filter - perspective - clip-path - mask / mask-image / mask-border - isolation 属性值为 isolate 的元素； - -webkit-overflow-scrolling 属性值为 touch 的元素； - will-change 值设定了任一属性而该属性在 non-initial 值时会创建层叠上下文的元素（参考这篇文章）； - contain 属性值为 layout、paint 或包含它们其中之一的合成值（比如 contain: strict、contain: content）的元素。")])])])])])]),e._v(" "),i("li",[i("ul",[i("li",[e._v("需要裁减的地方也会创建图层\n"),i("ul",[i("li",[e._v("超出当前图层的或者div的部份会出现滚动条,滚动条也会单独为一个图层,超出的部份会被裁减,也会被创建为图层")])])]),e._v(" "),i("li",[e._v("图层绘制\n"),i("ul",[i("li",[e._v("渲染去引擎会把图层的绘制拆分成很多小的绘制指令,然后在将这些指令按一定的顺序排列成一个待"),i("code",[e._v("绘制列表")]),e._v(".")])])])])]),e._v(" "),i("li",[i("p",[e._v("栅格化")]),e._v(" "),i("ul",[i("li",[i("code",[e._v("绘制列表")]),e._v("只是用来记录绘制顺序和指令的.真正的绘制是渲染引擎的合成线程来完成的\n"),i("ul",[i("li",[e._v("当图层的绘制列表准备好以后,主线程会把该列表提交到合成线程")])])]),e._v(" "),i("li",[e._v("视口: 浏览器中用户可以看得到的部份,在有些情况下，\n"),i("ul",[i("li",[e._v("有的图层可以很大，比如有的页面你使用滚动条要滚动好久才能滚动到底部，但是通过视口，用户只能看到页面的很小一部分，所以在这种情况下，要绘制出所有图层内容的话，就会产生太大的开销，而且也没有必要。")]),e._v(" "),i("li",[e._v("基于上面的原因,"),i("strong",[e._v("合成线程会将图层划分为图块")]),e._v(":大小通常为"),i("code",[e._v("256*256")]),e._v(",或 "),i("code",[e._v("512*512")])]),e._v(" "),i("li",[e._v("然后"),i("strong",[e._v("合成线程会将视口附近的图块优先生成位图,但实际上生成位图是由合成线程来完成的;所谓的栅格化:是将图层转化为位图")]),e._v(",而图块是栅格化最小单位,渲染进程维护了一个栅格化的线程池,所有的图块栅格化都是在线程池中完成的")]),e._v(" "),i("li",[e._v("通常: 栅格化的过程都会是使用GPU来加速,使用GPU将图块栅格化为位图的过程叫: 快速栅格化或者GPU 栅格化,然后将位图保存在GPU内存中")])])])]),e._v(" "),i("p",[i("img",{attrs:{src:t(359),alt:"img"}})])]),e._v(" "),i("li",[i("p",[e._v("合成与显示")]),e._v(" "),i("ul",[i("li",[e._v("如果在生成位图(栅格化)使用了GPU,那生成的位图是在GPU进程中完成的.这里会涉及到跨进程.\n"),i("ol",[i("li",[e._v("首先渲染进程里执行图层合成(Layer Compositor)，也就是生成图层的操作，具体地讲，渲染进程的合成线程接收到图层的绘制消息时，会通过光栅化线程池将其提交给GPU进程，在GPU进程中执行光栅化操作，执行完成，再将结果返回给渲染进程的合成线程，执行合成图层操作！")]),e._v(" "),i("li",[e._v("合成的图层会被提交给浏览器进程，浏览器进程里会执行显示合成(Display Compositor)，也就是将所有的图层合成为可以显示的页面图片。 最终显示器显示的就是浏览器进程中合成的页面图片")])])]),e._v(" "),i("li",[e._v('所以一旦栅格化完所有图块,合成线程就会生成一个绘制图块的命令---- "DrawQuad",然后将该命令提交给浏览器进程')]),e._v(" "),i("li",[e._v("然后浏览器进程中的viz组件会接收处理"),i("code",[e._v("**DrawQuad**")]),e._v("命令,将其页面内容绘制到内存中,最后在将内存显示到屏幕上")])])]),e._v(" "),i("li",[i("p",[e._v("总结")]),e._v(" "),i("ol",[i("li",[e._v("渲染进程将 HTML 内容转换为能够读懂的 DOM 树结构。")]),e._v(" "),i("li",[e._v("渲染引擎将 CSS 样式表转化为浏览器可以理解的 styleSheets，计算出 DOM 节点的样式。")]),e._v(" "),i("li",[e._v("创建布局树，并计算元素的布局信息。对布局树进行分层，并生成分层树。")]),e._v(" "),i("li",[e._v("为每个图层生成绘制列表，并将其提交到合成线程。")]),e._v(" "),i("li",[e._v("合成线程将图层分成图块，并在光栅化线程池中将图块转换成位图。")]),e._v(" "),i("li",[e._v("合成线程发送绘制图块命令 DrawQuad 给浏览器进程。")]),e._v(" "),i("li",[e._v("浏览器进程根据 DrawQuad 消息生成页面，并显示到显示器上。")])])]),e._v(" "),i("li",[i("p",[e._v("重排(改变元素的几何属性:eg: height,wdith...)会导致浏览器重新执行渲染流程")])]),e._v(" "),i("li",[i("p",[e._v("重绘(更新元素的绘制属性: eg: background,color...):因为没有几何位置的变化,和重排相比会少去布局和分层阶段")])]),e._v(" "),i("li",[i("p",[e._v("合成(不改变几何属性和绘制属性: eg: transform):只需要在合成阶段去处理合成动画")])]),e._v(" "),i("li",[i("p",[e._v("减少重绘重排的方法")]),e._v(" "),i("div",{staticClass:"language-javascript line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-javascript"}},[i("code",[i("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.")]),e._v(" 使用 "),i("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v(" 操作样式，而不是频繁操作 style\n"),i("span",{pre:!0,attrs:{class:"token number"}},[e._v("2.")]),e._v(" 避免使用 table 布局\n"),i("span",{pre:!0,attrs:{class:"token number"}},[e._v("3.")]),e._v(" 批量dom 操作，例如 createDocumentFragment，或者使用框架，例如 React\n"),i("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.")]),e._v(" Debounce window resize 事件\n"),i("span",{pre:!0,attrs:{class:"token number"}},[e._v("5.")]),e._v(" 对 dom 属性的读写要分离\n"),i("span",{pre:!0,attrs:{class:"token number"}},[e._v("6.")]),e._v(" will"),i("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("change"),i("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" transform 做优化\n")])]),e._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[e._v("1")]),i("br"),i("span",{staticClass:"line-number"},[e._v("2")]),i("br"),i("span",{staticClass:"line-number"},[e._v("3")]),i("br"),i("span",{staticClass:"line-number"},[e._v("4")]),i("br"),i("span",{staticClass:"line-number"},[e._v("5")]),i("br"),i("span",{staticClass:"line-number"},[e._v("6")]),i("br")])])])])])}),[],!1,null,null,null);l.default=s.exports}}]);